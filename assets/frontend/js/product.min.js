"use strict";var mvxAfmLibrary=function(a){return{datePickerSelect:function(t){var e=a(t).is(".sale_price_dates_from")?"minDate":"maxDate",i="minDate"===e?a(t).closest(".sale_price_dates_fields").find(".sale_price_dates_to"):a(t).closest(".sale_price_dates_fields").find(".sale_price_dates_from"),o=a(t).datepicker("getDate");a(i).datepicker("option",e,o),a(t).change()},wcEnhancedSelectInit:function(){try{a(":input.wc-enhanced-select, :input.chosen_select").filter(":not(.enhanced)").each(function(){var t={minimumResultsForSearch:10,allowClear:!!a(this).data("allow_clear"),placeholder:a(this).data("placeholder")};a(this).selectWoo(t).addClass("enhanced")}),a(":input.wc-product-search").filter(":not(.enhanced)").each(function(){var t={allowClear:!!a(this).data("allow_clear"),placeholder:a(this).data("placeholder"),minimumInputLength:a(this).data("minimum_input_length")?a(this).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:{url:mvx_advance_product_params.ajax_url,dataType:"json",delay:250,data:function(t){return{term:t.term,action:a(this).data("action")||"woocommerce_json_search_products_and_variations",security:mvx_advance_product_params.search_products_nonce,exclude:a(this).data("exclude"),include:a(this).data("include"),limit:a(this).data("limit")}},processResults:function(t){var e=[];return t&&a.each(t,function(a,t){e.push({id:a,text:t})}),{results:e}},cache:!0}};if(a(this).selectWoo(t).addClass("enhanced"),a(this).data("sortable")){var e=a(this),i=a(this).next(".select2-container").find("ul.select2-selection__rendered");i.sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop:function(){a(i.find(".select2-selection__choice").get().reverse()).each(function(){var t=a(this).data("data").id,i=e.find('option[value="'+t+'"]')[0];e.prepend(i)})}})}else a(this).prop("multiple")&&a(this).on("change",function(){var t=a(this).children();t.sort(function(a,t){var e=a.text.toLowerCase(),i=t.text.toLowerCase();return e>i?1:e<i?-1:0}),a(this).html(t)})})}catch(a){window.console.log(a)}},wcEnhancedSelectClose:function(){try{a("html").on("click",function(t){this===t.target&&a(".wc-enhanced-select, :input.wc-product-search").filter(".select2-hidden-accessible").selectWoo("close")})}catch(a){window.console.log(a)}},qtip:function(){a(".img_tip").each(function(){a(this).qtip({content:a(this).attr("data-desc"),position:{my:"top center",at:"bottom center",viewport:a(window)},show:{event:"mouseover",solo:!0},hide:{inactive:6e3,fixed:!0},style:{classes:"qtip-dark qtip-shadow qtip-rounded qtip-dc-css",width:200}})})}}}(jQuery),mvxAfmProductEditor=function(a){var t={productType:a("select#product-type").val(),manageStock:a("input#_manage_stock").is(":checked")},e=null,i=null,o=null;return{getState:function(a){return t.hasOwnProperty(a)?t[a]:""},setState:function(a,e){return!(!t.hasOwnProperty(a)||!e)&&(t[a]=e,!0)},init:function(){a("#woocommerce-product-data").on("change","select#product-type",this.productTypeChanged.bind(this)).on("change","input#_downloadable, input#_virtual",this.updateTabsDisplay.bind(this)).on("click",".sale_schedule",this.showSalePriceDates).on("click",".cancel_sale_schedule",this.hideSalePriceDates).on("change","input#_manage_stock",this.stockManagementPreferenceChanged.bind(this)),a(".add-product-single").on("click",".notice-wrapper button.notice-dismiss",this.dismissNotice),a("#mvx-edit-product-form").on("click","#mvx_afm_product_submit, #mvx_afm_product_draft",this.saveProduct.bind(this)),a("#mvx-edit-product-form").on("change",'ul.taxonomy-widget input[name^="tax_input"]',this.taxInputChanged.bind(this)),e=this.mediaController(),i=this.downloadsController(),o=this.attributeController(),this.setupEnvironment()},mediaController:function(){var t=null,e=null,i=a("#product_image_gallery");return{init:function(){a(".featured-img").on("click",".upload_image_button:not(.remove)",this.addFeaturedImage).on("click",".upload_image_button.remove",this.removeFeaturedImage),a("#product_images_container").on("click",".add_product_images a",this.addGalleryImages).on("click",".product_images a.delete",this.removeGalleryImage),this.initGalleryImagesSort()},addFeaturedImage:function(e){var i=a(this),o=i.closest(".upload_image");e.preventDefault(),t?t.open():((t=wp.media.frames.featured_image=wp.media({title:i.data("title"),button:{text:i.data("button")},states:[new wp.media.controller.Library({title:i.data("title"),filterable:"all"})]})).on("select",function(){var e=t.state().get("selection").first().toJSON(),i=e.sizes&&e.sizes.medium?e.sizes.medium.url:e.url;a(".upload_image_id",o).val(e.id).change(),o.find(".upload_image_button").addClass("remove"),o.find("img").eq(0).attr("src",i)}),t.open())},removeFeaturedImage:function(t){t.preventDefault();var e=a(this).closest(".upload_image");a(".upload_image_id",e).val("").change(),e.find("img").eq(0).attr("src",mvx_advance_product_params.woocommerce_placeholder_img_src),e.find(".upload_image_button").removeClass("remove")},addGalleryImages:function(t){var o=a(this),r=a("#product_images_container").find("ul.product_images");t.preventDefault(),e?e.open():((e=wp.media.frames.product_gallery=wp.media({title:o.data("choose"),button:{text:o.data("update")},states:[new wp.media.controller.Library({title:o.data("choose"),filterable:"all",multiple:!0})]})).on("select",function(){var a=e.state().get("selection"),t=i.val();a.map(function(a){if((a=a.toJSON()).id){t=t?t+","+a.id:a.id;var e=a.sizes&&a.sizes.thumbnail?a.sizes.thumbnail.url:a.url;r.append('<li class="image" data-attachment_id="'+a.id+'"><img src="'+e+'" /><ul class="actions"><li><a href="#" class="delete" title="'+o.data("delete")+'">'+o.data("text")+"</a></li></ul></li>")}}),i.val(t)}),e.open())},removeGalleryImage:function(){a(this).closest("li.image").remove();var t="";return a("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var e=a(this).attr("data-attachment_id");t=t+e+","}),i.val(t),!1},initGalleryImagesSort:function(){a("#product_images_container").find("ul.product_images").sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"product-image-gallery-placeholder",start:function(a,t){t.item.css("background-color","#f6f6f6")},stop:function(a,t){t.item.removeAttr("style")},update:function(){var t="";a("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var e=a(this).attr("data-attachment_id");t=t+e+","}),i.val(t)}})}}},downloadsController:function(){var t,e;return{init:function(){a("#woocommerce-product-data").on("click",".downloadable_files a.insert",this.insertDownloadableFiles).on("click",".downloadable_files a.delete",this.deleteDownloadableFiles).on("click",".downloadable_files a.upload_file_button",this.fileUploaded).on("downloadable_file_fields_inserted",this.sortDownloadableFiles)},insertDownloadableFiles:function(){return a(this).closest(".downloadable_files").find("tbody").append(a(this).data("row")),!1},deleteDownloadableFiles:function(){return a(this).closest("tr").remove(),!1},fileUploaded:function(i){var o=a(this);if(e=o.closest("tr").find("td.file_url input"),i.preventDefault(),t)t.open();else{var r=[new wp.media.controller.Library({library:wp.media.query(),multiple:!0,title:o.data("choose"),priority:20,filterable:"uploaded"})];(t=wp.media.frames.downloadable_file=wp.media({title:o.data("choose"),library:{type:""},button:{text:o.data("update")},multiple:!0,states:r})).on("select",function(){var a="";t.state().get("selection").map(function(t){(t=t.toJSON()).url&&(a=t.url)}),e.val(a).change()}),t.on("ready",function(){t.uploader.options.uploader.params={type:"downloadable_product"}}),t.open()}},sortDownloadableFiles:function(){a(".downloadable_files tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"span.sortable-icon",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"downloadable-files-sortable-placeholder",start:function(a,t){t.item.css("background-color","#f6f6f6")},stop:function(a,t){t.item.removeAttr("style")}})}}},setupEnvironment:function(){a("select#product-type").change(),a("input#_manage_stock").change(),mvxAfmLibrary.wcEnhancedSelectInit(),mvxAfmLibrary.wcEnhancedSelectClose(),mvxAfmLibrary.qtip(),e.init(),i.init(),o.init(),this.salePriceDateFieldInit(a("#woocommerce-product-data")),a("#woocommerce-product-data").trigger("downloadable_file_fields_inserted"),a(".multiselect.product_tag").select2({tags:mvx_advance_product_params.add_tags,tokenSeparators:[","],placeholder:a(this).data("placeholder")}).on("change",function(){var t=a(this).find('[data-select2-tag="true"]');if(t.length){var e={action:"mvx_product_tag_add",new_tag:t.val()};a.ajax({type:"POST",url:mvx_advance_product_params.ajax_url,data:e,success:function(e){if(e.status){var i=e.tag?e.tag.term_id:t.val();t.replaceWith('<option selected value="'+i+'">'+t.val()+"</option>")}else""!=e.message&&(a(".woocommerce-error,woocommerce-message").remove(),a("#mvx-afm-add-product").prepend('<div class="woocommerce-error" tabindex="-1">'+e.message+"</div>"),a(".woocommerce-error").focus()),a('.multiselect.product_tag option[value="'+t.val()+'"]').remove()}})}}),a("#product_data_tabs").afmTabInit()},salePriceDateFieldInit:function(t){a(".sale_price_dates_fields",t).each(function(){var t=a(this),e=!1,i=t.closest("div.form-group-row");t.find("input").each(function(){""!==a(this).val()&&(e=!0),mvxAfmLibrary.datePickerSelect(a(this))}),e?(i.find(".sale_schedule").hide(),i.find(".sale_price_dates_fields").show()):(i.find(".sale_schedule").show(),i.find(".sale_price_dates_fields").hide())})},productTypeChanged:function(){var t=a("select#product-type").val();this.setState("productType",t),"variable"===t?(a("input#_manage_stock").change(),a("input#_downloadable").prop("checked",!1),a("input#_virtual").removeAttr("checked")):"grouped"===t?(a("input#_downloadable").prop("checked",!1),a("input#_virtual").removeAttr("checked")):"external"===t&&(a("input#_downloadable").prop("checked",!1),a("input#_virtual").removeAttr("checked")),a("#woocommerce-product-data").trigger("afm-product-type-changed"),this.updateTabsDisplay(),a("ul#product_data_tabs li:visible").eq(0).find("a").tab("show")},updateTabsDisplay:function(){var t=this.getState("productType"),e=a("input#_virtual:checked").length,i=a("input#_downloadable:checked").length,o=".hide_if_downloadable, .hide_if_virtual",r=".show_if_downloadable, .show_if_virtual",n=JSON.parse(mvx_advance_product_params.default_product_types),c=JSON.parse(mvx_advance_product_params.product_types);a.extend(c,n),a.each(c,function(a,t){o=o+", .hide_if_"+a,r=r+", .show_if_"+a}),a(o).show(),a(r).hide(),i&&a(".show_if_downloadable").show(),e&&a(".show_if_virtual").show(),a(".show_if_"+t).show(),i&&a(".hide_if_downloadable").hide(),e&&a(".hide_if_virtual").hide(),a(".hide_if_"+t).hide(),a("input#_manage_stock").change(),a(".tab-pane").each(function(){var t=a(this).find(".row-padding > div");if(0!==t.length&&t.filter(function(){return"none"===a(this).css("display")}).length===t.length){var e=a(this).prop("id");a("#product_data_tabs").find('li a[href="#'+e+'"]').parent().hide()}}),a("#product_data_tabs").trigger("tab-display-updated")},showSalePriceDates:function(){var t=a(this).closest("div.form-group-row");return a(this).hide(),t.find(".cancel_sale_schedule").show(),t.find(".sale_price_dates_fields").show(),!1},hideSalePriceDates:function(){var t=a(this).closest("div.form-group-row");return a(this).hide(),t.find(".sale_schedule").show(),t.find(".sale_price_dates_fields").hide(),t.find(".sale_price_dates_fields").find("input").val(""),!1},stockManagementPreferenceChanged:function(){var t=this.getState("productType"),e=a("input#_manage_stock").is(":checked");this.setState("manageStock",e),e?(a("div.stock_fields:not( .hide_if_"+t+" )").show(),a("div.stock_status_field").hide()):(a("div.stock_fields").hide(),a("div.stock_status_field:not( .hide_if_"+t+" )").show())},attributeController:function(){var t=this;return{init:function(){var t=a(".product_attributes").find(".woocommerce_attribute").get();a(t).each(function(t,e){a(e).is(".taxonomy")&&a("select.attribute_taxonomy").find('option[value="'+a(e).data("taxonomy")+'"]').attr("disabled","disabled")}),mvx_advance_product_params.custom_attribute||this.customAttributeCapCheck(),this.initSortableComponent(),a("#product_attributes_data").on("change","input.attribute_name",this.changeCustomAttributeName).on("click","button.select_all_attributes",this.selectAllAttributes).on("click","button.select_no_attributes",this.removeAllAttributes).on("click","button.add_attribute",this.addAttribute.bind(this)).on("click","a.remove_row",this.removeAttribute.bind(this)).on("click",".save_attributes",this.saveAttribute.bind(this)).on("click",".expand_all",this.expandAllAttributes).on("click",".close_all",this.closeAllAttributes)},customAttributeCapCheck:function(){var t=a("select.attribute_taxonomy").children(":not([disabled=disabled])").first().val();t?a("select.attribute_taxonomy").val(t):a("button.add_attribute").attr("disabled","disabled")},initSortableComponent:function(){var t=this,e={items:".woocommerce_attribute",cursor:"move",axis:"y",handle:".variation-title",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"mvx-metabox-sortable-placeholder",start:function(a,t){t.item.css("background-color","#f6f6f6")},stop:function(a,e){e.item.removeAttr("style"),t.updateRowIndices()}};a(".product_attributes").sortable(e)},changeCustomAttributeName:function(){a(this).closest(".woocommerce_attribute").find("strong.attribute_name").text(a(this).val())},selectAllAttributes:function(){return a(this).closest("td").find("select option").attr("selected","selected"),a(this).closest("td").find("select").change(),!1},removeAllAttributes:function(){return a(this).closest("td").find("select option").removeAttr("selected"),a(this).closest("td").find("select").change(),!1},updateRowIndices:function(){a(".product_attributes .woocommerce_attribute").each(function(t,e){a(".attribute_position",e).val(parseInt(a(e).index(".product_attributes .woocommerce_attribute"),10))})},addAttribute:function(e){var i=this,o=a(".product_attributes .woocommerce_attribute").get(),r=0;o.length>0&&(r=o.reduce(function(t,e){var i=parseInt(a(e).find(".woocommerce_attribute_data").attr("id").replace("attribute_",""),10);return isNaN(i)||t>i?t:i},0),++r);var n=a("select.attribute_taxonomy").val();if(n||"1"==mvx_advance_product_params.custom_attribute){var c=a("#product_attributes_data"),s=c.find(".product_attributes"),d=t.getState("productType"),l={action:"mvx_edit_product_attribute",taxonomy:n,i:r,security:mvx_advance_product_params.add_attribute_nonce};c.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),a.post(mvx_advance_product_params.ajax_url,l,function(t){"-1"!=t&&(s.append(t),"variable"!==d&&s.find(".enable_variation").hide(),mvxAfmLibrary.wcEnhancedSelectInit(),mvxAfmLibrary.qtip(),i.updateRowIndices(),s.find(".woocommerce_attribute").last().find(".variation-title").click(),a("#product_attributes_data").trigger("attribute_added")),c.unblock()})}if(n)if(a("select.attribute_taxonomy").find('option[value="'+n+'"]').attr("disabled","disabled"),1==mvx_advance_product_params.custom_attribute)a("select.attribute_taxonomy").val("");else{var _=a("select.attribute_taxonomy").children(":not([disabled=disabled])").first().val();_?a("select.attribute_taxonomy").val(_):a("button.add_attribute").attr("disabled","disabled")}return!1},removeAttribute:function(t){if(window.confirm(mvx_advance_product_params.remove_attribute)){var e=a(t.target).closest(".woocommerce_attribute");e.is(".taxonomy")&&a("select.attribute_taxonomy").find('option[value="'+e.data("taxonomy")+'"]').removeAttr("disabled"),e.remove(),this.updateRowIndices()}return!1},saveAttribute:function(e){var i=a("#woocommerce-product-data");i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var o={post_id:mvx_advance_product_params.product_id,product_type:t.getState("productType"),data:a(".product_attributes").find("input, select, textarea").serialize(),action:"mvx_product_save_attributes",security:mvx_advance_product_params.save_attributes_nonce};a.post(mvx_advance_product_params.ajax_url,o,function(){var a=window.location.toString();a=a.replace(/(?:\/#?|\/\d+\/?)?$/,"/"+mvx_advance_product_params.product_id+"/"),i.unblock(),i.trigger("mvx_after_save_attribute_triggered")})},expandAllAttributes:function(){return a(this).closest("#product_attributes_data").find(".mvx-metabox-wrapper > .mvx-metabox-content").collapse("show"),!1},closeAllAttributes:function(){return a(this).closest("#product_attributes_data").find(".mvx-metabox-wrapper > .mvx-metabox-content").collapse("hide"),!1}}},variationController:function(){var t=this,e=null,i=null,o=null;return{init:function(){(e=this.variationActionsController()).init(),(i=this.variationAjaxController()).init(),this.variationMediaController().init(),(o=this.variationPaginationController()).init()},variationActionsController:function(){return{init:function(){a("#variable_product_options").on("change","input.variable_is_downloadable",this.variableIsDownloadable).on("change","input.variable_is_virtual",this.variableIsVirtual).on("change","input.variable_manage_stock",this.variableManageStock).on("click",".woocommerce_variation span.sort.sortable-icon",this.setMenuOrder).on("click",".variation-title select, .variation-title .remove_row",this.stopToggle).on("click",".expand_all",this.expandAllVariations).on("click",".close_all",this.closeAllVariations).on("reload",this.reload),a("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock").change(),a("#woocommerce-product-data").on("woocommerce_variations_loaded",this.variationsLoaded),a(document.body).on("woocommerce_variations_added",this.variationAdded)},initSortableComponent:function(){var t={items:".woocommerce_variation",cursor:"move",axis:"y",handle:".variation-title",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"variation-sortable-placeholder",start:function(a,t){t.item.css("background-color","#f6f6f6")},stop:function(a,t){t.item.removeAttr("style"),e.variationRowIndexes()}};a(".woocommerce_variations").sortable(t)},expandAllVariations:function(){return a(this).closest("#variable_product_options").find(".mvx-metabox-wrapper > .mvx-metabox-content").collapse("show"),!1},closeAllVariations:function(){return a(this).closest("#variable_product_options").find(".mvx-metabox-wrapper > .mvx-metabox-content").collapse("hide"),!1},reload:function(){i.loadVariations(1),o.setPaginav(0)},variableIsDownloadable:function(){a(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_downloadable").hide(),a(this).is(":checked")&&a(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_downloadable").show()},variableIsVirtual:function(){a(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_virtual").show(),a(this).is(":checked")&&a(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_virtual").hide()},variableManageStock:function(){a(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_manage_stock").hide(),a(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_manage_stock").show(),a(this).is(":checked")&&(a(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_manage_stock").show(),a(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_manage_stock").hide())},stopToggle:function(a){a.stopPropagation()},variationsLoaded:function(i,o){o=o||!1;var r=a("#woocommerce-product-data");o||(a("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock",r).change(),a(".woocommerce_variation",r).each(function(t,e){var i=a(e),o=a(".sale_price_dates_from",i).val(),r=a(".sale_price_dates_to",i).val();""===o&&""===r||a("a.sale_schedule",i).click()}),a(".woocommerce_variations .variation-needs-update",r).removeClass("variation-needs-update"),a("button.cancel-variation-changes, button.save-variation-changes",r).attr("disabled","disabled")),t.salePriceDateFieldInit(r),mvxAfmLibrary.wcEnhancedSelectInit(),mvxAfmLibrary.qtip(),e.initSortableComponent(),a("#woocommerce-product-data").trigger("downloadable_file_fields_inserted")},variationAdded:function(a,t){1===t&&e.variationsLoaded(null,!0)},setMenuOrder:function(t){t.preventDefault();var e=a(this).closest(".woocommerce_variation").find(".variation_menu_order"),o=window.prompt(mvx_advance_product_params.i18n_enter_menu_order,e.val()),r=parseInt(o,10);return isNaN(r)||(e.val(r).change(),i.saveVariations()),!1},variationRowIndexes:function(){var t=a("#variable_product_options").find(".woocommerce_variations"),e=parseInt(t.attr("data-page"),10),i=parseInt((e-1)*mvx_advance_product_params.variations_per_page,10);a(".woocommerce_variations .woocommerce_variation").each(function(t,e){a(".variation_menu_order",e).val(parseInt(a(e).index(".woocommerce_variations .woocommerce_variation"),10)+1+i).change()})}}},variationAjaxController:function(){return{init:function(){a("li.variations_tab a").on("click",this.initialLoad),a("#variable_product_options").on("click","button.save-variation-changes",this.saveVariations).on("click","button.cancel-variation-changes",this.cancelVariations).on("click",".remove_variation",this.removeVariation),a(document.body).on("change","#variable_product_options .woocommerce_variations :input",this.inputChanged).on("change",".variations-defaults select",this.defaultsChanged),a("form#mvx-afm-add-product").on("submit",this.saveOnSubmit),a(".collapsable-component-wrapper").on("click","a.do_variation_action",this.doVariationAction)},checkForChanges:function(){var t=a("#variable_product_options").find(".woocommerce_variations .variation-needs-update");if(0<t.length){if(!window.confirm(mvx_advance_product_params.i18n_edited_variations))return t.removeClass("variation-needs-update"),!1;this.saveChanges()}return!0},block:function(){a("#woocommerce-product-data").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#woocommerce-product-data").unblock()},initialLoad:function(){0===a("#variable_product_options").find(".woocommerce_variations .woocommerce_variation").length&&o.goToPage()},loadVariations:function(t,e){t=t||1,e=e||mvx_advance_product_params.variations_per_page;var o=a("#variable_product_options").find(".woocommerce_variations");i.block(),a.ajax({url:mvx_advance_product_params.ajax_url,data:{action:"mvx_afm_load_variations",security:mvx_advance_product_params.load_variations_nonce,product_id:mvx_advance_product_params.product_id,attributes:o.data("attributes"),page:t,per_page:e},type:"POST",success:function(e){o.empty().append(e).attr("data-page",t),a("#woocommerce-product-data").trigger("woocommerce_variations_loaded"),i.unblock()}})},getVariationsFields:function(t){var e=a(":input",t).serializeJSON();return a(".variations-defaults select").each(function(t,i){var o=a(i);e[o.attr("name")]=o.val()}),e},saveChanges:function(e){var o=a("#variable_product_options").find(".woocommerce_variations"),r=a(".variation-needs-update",o),n={};0<r.length&&(i.block(),(n=this.getVariationsFields(r)).action="woocommerce_save_variations",n.security=mvx_advance_product_params.save_variations_nonce,n.product_id=mvx_advance_product_params.product_id,n["product-type"]=t.getState("productType"),a.ajax({url:mvx_advance_product_params.ajax_url,data:n,type:"POST",success:function(t){r.removeClass("variation-needs-update"),a("button.cancel-variation-changes, button.save-variation-changes").attr("disabled","disabled"),a("#woocommerce-product-data").trigger("woocommerce_variations_saved"),"function"==typeof e&&e(t),i.unblock()}}))},saveVariations:function(){return a("#variable_product_options").trigger("woocommerce_variations_save_variations_button"),i.saveChanges(function(t){var e=a("#variable_product_options").find(".woocommerce_variations"),i=e.attr("data-page");a("#variable_product_options").find("#woocommerce_errors").remove(),t&&e.before(t),a(".variations-defaults select").each(function(){a(this).attr("data-current",a(this).val())}),o.goToPage(i)}),!1},saveOnSubmit:function(t){0<a("#variable_product_options").find(".woocommerce_variations .variation-needs-update").length&&(t.preventDefault(),a("#variable_product_options").trigger("woocommerce_variations_save_variations_on_submit"),i.saveChanges(i.saveOnSubmitDone))},saveOnSubmitDone:function(){a("form#post").submit()},cancelVariations:function(){var t=parseInt(a("#variable_product_options").find(".woocommerce_variations").attr("data-page"),10);return a("#variable_product_options").find(".woocommerce_variations .variation-needs-update").removeClass("variation-needs-update"),a(".variations-defaults select").each(function(){a(this).val(a(this).attr("data-current"))}),o.goToPage(t),!1},addVariation:function(){this.block();var t={action:"mvx_afm_add_variation",post_id:mvx_advance_product_params.product_id,loop:a(".woocommerce_variation").length,security:mvx_advance_product_params.add_variation_nonce};return a.post(mvx_advance_product_params.ajax_url,t,function(t){var e=a(t);e.addClass("variation-needs-update"),a("#variable_product_options").find(".woocommerce_variations").prepend(e),a("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),a("#variable_product_options").trigger("woocommerce_variations_added",1),i.unblock()}),!1},removeVariation:function(){if(i.checkForChanges(),window.confirm(mvx_advance_product_params.i18n_remove_variation)){var t=a(this).attr("rel"),e=[],r={action:"woocommerce_remove_variations"};i.block(),0<t?(e.push(t),r.variation_ids=e,r.security=mvx_advance_product_params.delete_variations_nonce,a.post(mvx_advance_product_params.ajax_url,r,function(){var t=a("#variable_product_options").find(".woocommerce_variations"),e=parseInt(t.attr("data-page"),10),i=Math.ceil((parseInt(t.attr("data-total"),10)-1)/mvx_advance_product_params.variations_per_page),r=1;a("#woocommerce-product-data").trigger("woocommerce_variations_removed"),e===i||e<=i?r=e:e>i&&0!==i&&(r=i),o.goToPage(r,-1)})):i.unblock()}return!1},linkAllVariations:function(){if(this.checkForChanges(),window.confirm(mvx_advance_product_params.i18n_link_all_variations)){this.block();var t={action:"woocommerce_link_all_variations",post_id:mvx_advance_product_params.product_id,security:mvx_advance_product_params.link_variation_nonce};a.post(mvx_advance_product_params.ajax_url,t,function(t){var e=parseInt(t,10);1===e?window.alert(e+" "+mvx_advance_product_params.i18n_variation_added):0===e||e>1?window.alert(e+" "+mvx_advance_product_params.i18n_variations_added):window.alert(mvx_advance_product_params.i18n_no_variations_added),e>0?(o.goToPage(1,e),a("#variable_product_options").trigger("woocommerce_variations_added",e)):i.unblock()})}return!1},inputChanged:function(){a(this).closest(".woocommerce_variation").addClass("variation-needs-update"),a("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),a("#variable_product_options").trigger("woocommerce_variations_input_changed")},defaultsChanged:function(){a(this).closest("#variable_product_options").find(".woocommerce_variation:first").addClass("variation-needs-update"),a("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),a("#variable_product_options").trigger("woocommerce_variations_defaults_changed")},doVariationAction:function(){var e,r=a("select.variation_actions").val(),n={},c=0;switch(r){case"add_variation":return void i.addVariation();case"link_all_variations":return void i.linkAllVariations();case"delete_all":window.confirm(mvx_advance_product_params.i18n_delete_all_variations)&&window.confirm(mvx_advance_product_params.i18n_last_warning)&&(n.allowed=!0,c=-1*parseInt(a("#variable_product_options").find(".woocommerce_variations").attr("data-total"),10));break;case"variable_regular_price_increase":case"variable_regular_price_decrease":case"variable_sale_price_increase":case"variable_sale_price_decrease":if(null===(e=window.prompt(mvx_advance_product_params.i18n_enter_a_value_fixed_or_percent)))return;e.indexOf("%")>=0?n.value=accounting.unformat(e.replace(/\%/,""),mvx_advance_product_params.mon_decimal_point)+"%":n.value=accounting.unformat(e,mvx_advance_product_params.mon_decimal_point);break;case"variable_regular_price":case"variable_sale_price":case"variable_stock":case"variable_weight":case"variable_length":case"variable_width":case"variable_height":case"variable_download_limit":case"variable_download_expiry":if(null===(e=window.prompt(mvx_advance_product_params.i18n_enter_a_value)))return;n.value=e;break;case"variable_sale_schedule":if(n.date_from=window.prompt(mvx_advance_product_params.i18n_scheduled_sale_start),n.date_to=window.prompt(mvx_advance_product_params.i18n_scheduled_sale_end),null===n.date_from&&(n.date_from=!1),null===n.date_to&&(n.date_to=!1),!1===n.date_to&&!1===n.date_from)return;break;default:a("select.variation_actions").trigger(r),n=a("select.variation_actions").triggerHandler(r+"_ajax_data",n)}"delete_all"===r&&n.allowed?a("#variable_product_options").find(".variation-needs-update").removeClass("variation-needs-update"):i.checkForChanges(),i.block(),a.ajax({url:mvx_advance_product_params.ajax_url,data:{action:"woocommerce_bulk_edit_variations",security:mvx_advance_product_params.bulk_edit_variations_nonce,product_id:mvx_advance_product_params.product_id,product_type:t.getState("productType"),bulk_action:r,data:n},type:"POST",success:function(){o.goToPage(1,c)}})}}},variationMediaController:function(){var t=null,e=null,i=null,o=wp.media.model.settings.post.id;return{init:function(){a("#variable_product_options").on("click",".upload_image_button",this.addImage),a("a.add_media").on("click",this.restoreWPMediaPostId)},addImage:function(r){var n=a(this),c=n.attr("rel"),s=n.closest(".upload_image");if(i=s,e=c,r.preventDefault(),n.is(".remove"))a(".upload_image_id",i).val("").change(),i.find("img").eq(0).attr("src",mvx_advance_product_params.woocommerce_placeholder_img_src),i.find(".upload_image_button").removeClass("remove");else{if(t)return t.uploader.uploader.param("post_id",e),void t.open();wp.media.model.settings.post.id=e,(t=wp.media.frames.variable_image=wp.media({title:mvx_advance_product_params.i18n_choose_image,button:{text:mvx_advance_product_params.i18n_set_image},states:[new wp.media.controller.Library({title:mvx_advance_product_params.i18n_choose_image,filterable:"all"})]})).on("select",function(){var e=t.state().get("selection").first().toJSON(),r=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;a(".upload_image_id",i).val(e.id).change(),i.find(".upload_image_button").addClass("remove"),i.find("img").eq(0).attr("src",r),wp.media.model.settings.post.id=o}),t.open()}},restoreWPMediaPostId:function(){wp.media.model.settings.post.id=o}}},variationPaginationController:function(){return{init:function(){a(document.body).on("woocommerce_variations_added",this.updateSingleQuantity).on("change",".variations-pagenav .page-selector",this.pageSelector).on("click",".variations-pagenav .first-page",this.firstPage).on("click",".variations-pagenav .prev-page",this.prevPage).on("click",".variations-pagenav .next-page",this.nextPage).on("click",".variations-pagenav .last-page",this.lastPage)},updateVariationsCount:function(t){var e=a("#variable_product_options").find(".woocommerce_variations"),i=parseInt(e.attr("data-total"),10)+t,o=a(".variations-pagenav .displaying-num");return e.attr("data-total",i),1===i?o.text(mvx_advance_product_params.i18n_variation_count_single.replace("%qty%",i)):o.text(mvx_advance_product_params.i18n_variation_count_plural.replace("%qty%",i)),i},updateSingleQuantity:function(t,e){if(1===e){var i=a(".variations-pagenav");o.updateVariationsCount(e),i.is(":hidden")&&(a("option, optgroup",".variation_actions").show(),a(".variation_actions").val("add_variation"),a("#variable_product_options").find(".toolbar").show(),i.show(),a(".pagination-links",i).hide())}},setPaginav:function(t){var e=a("#variable_product_options").find(".woocommerce_variations"),i=this.updateVariationsCount(t),o=a("#variable_product_options").find(".toolbar"),r=a(".variation_actions"),n=a(".variations-pagenav"),c=a(".pagination-links",n),s=Math.ceil(i/mvx_advance_product_params.variations_per_page),d="";e.attr("data-total_pages",s),a(".total-pages",n).text(s);for(var l=1;l<=s;l++)d+='<option value="'+l+'">'+l+"</option>";a(".page-selector",n).empty().html(d),0===i?(o.not(".toolbar-top, .toolbar-buttons").hide(),n.hide(),a("option, optgroup",r).hide(),a(".variation_actions").val("add_variation"),a('option[data-global="true"]',r).show()):(o.show(),n.show(),a("option, optgroup",r).show(),a(".variation_actions").val("add_variation"),1===s?c.hide():c.show())},checkIsEnabled:function(t){return!a(t).hasClass("disabled")},changeClasses:function(t,e){var i=a(".variations-pagenav .first-page"),o=a(".variations-pagenav .prev-page"),r=a(".variations-pagenav .next-page"),n=a(".variations-pagenav .last-page");1===t?(i.addClass("disabled"),o.addClass("disabled")):(i.removeClass("disabled"),o.removeClass("disabled")),e===t?(r.addClass("disabled"),n.addClass("disabled")):(r.removeClass("disabled"),n.removeClass("disabled"))},setPage:function(t){a(".variations-pagenav .page-selector").val(t).first().change()},goToPage:function(a,t){a=a||1,t=t||0,this.setPaginav(t),this.setPage(a)},pageSelector:function(){var t=parseInt(a(this).val(),10),e=a("#variable_product_options").find(".woocommerce_variations");a(".variations-pagenav .page-selector").val(t),i.checkForChanges(),o.changeClasses(t,parseInt(e.attr("data-total_pages"),10)),i.loadVariations(t)},firstPage:function(){return o.checkIsEnabled(this)&&o.setPage(1),!1},prevPage:function(){if(o.checkIsEnabled(this)){var t=a("#variable_product_options").find(".woocommerce_variations"),e=parseInt(t.attr("data-page"),10)-1,i=0<e?e:1;o.setPage(i)}return!1},nextPage:function(){if(o.checkIsEnabled(this)){var t=a("#variable_product_options").find(".woocommerce_variations"),e=parseInt(t.attr("data-total_pages"),10),i=parseInt(t.attr("data-page"),10)+1,r=e>=i?i:e;o.setPage(r)}return!1},lastPage:function(){if(o.checkIsEnabled(this)){var t=a("#variable_product_options").find(".woocommerce_variations").attr("data-total_pages");o.setPage(t)}return!1}}}}},dismissNotice:function(){a(this).parent().remove()},getTinymceContent:function(t){return a("#wp-"+t+"-wrap").hasClass("tmce-active")&&"undefined"!=typeof tinyMCE&&tinyMCE.get(t)?tinyMCE.get(t).getContent():a("textarea#"+t).val()},saveProduct:function(t){a("form#mvx-edit-product-form").trigger("before_product_save");var e="mvx_afm_product_submit"===t.target.id?"publish":"mvx_afm_product_draft"===t.target.id?"draft":"";return a('input:hidden[name="status"]').val(e),a("textarea#product_description").val(this.getTinymceContent("product_description")),a("textarea#product_excerpt").val(this.getTinymceContent("product_excerpt")),!0},taxInputChanged:function(t){a(this).is(":checked")||a(this).prop("checked",!1)}}}(jQuery);jQuery(function(){mvxAfmProductEditor.init()});